AJS.Attachments={showOlderVersions:function(a){a(".attachment-history a").click(function(d){var b=a(this).parents("table.attachments");var c=a(this).parents("tr:first")[0].id.substr(11);var f=a(".history-"+c,b);a(this).toggleClass("icon-section-opened");a(this).toggleClass("icon-section-closed");f.toggleClass("hidden");return AJS.stopEvent(d)})}};AJS.toInit(function(d){var i=d("#more-attachments-link");i.click(function(k){d(".more-attachments").removeClass("hidden");i.addClass("hidden");return AJS.stopEvent(k)});AJS.Attachments.showOlderVersions(d);var g=AJS.Confluence.Templates.Attachments;function a(k,l){return d(k).parents("["+l+"]").attr(l)}function e(k){return a(k,"data-attachment-filename")}function b(k){return a(k,"data-attachment-version")}function c(m,n,k,l){n=n||{};AJS.safe.ajax({type:"POST",url:m,data:n,success:k,error:l})}function j(l){var k=AJS.ConfluenceDialog({width:600,height:200,id:l});return k}function h(k,l,n){var m=j("attachment-removal-confirm-dialog");m.addHeader(l);m.addPanel("",n);m.addSubmit(AJS.I18n.getText("remove.name"),function(){var o=function(r,s,q){location.reload(true)};var p=function(s,v,u){var r=null;if(s.responseText){var q=d.parseJSON(s.responseText);if(q.actionErrors){r=q.actionErrors}}var t=j("attachment-removal-error-dialog");t.addHeader(g.removalErrorTitle());t.addPanel("",g.removalErrorBody({messages:r}));t.addButton(AJS.I18n.getText("close.name"),function(){location.reload(true)});t.show();m.remove()};c(k,null,o,p)});m.addCancel(AJS.I18n.getText("cancel.name"),function(){m.remove()});m.show()}function f(l,k){return AJS.Confluence.getContextPath()+l+k}d(".removeAttachmentLink").click(function(){AJS.Attachments.showRemoveAttachmentConfirmDialog(this);return false});d(".removeAttachmentLinkVersion").click(function(k){h(f("/json/removeattachmentversion.action",this.search),g.versionRemovalConfirmationTitle(),g.versionRemovalConfirmationBody({filename:e(this),version:b(this)}));return false});AJS.Attachments.showRemoveAttachmentConfirmDialog=function(n){var k=f("/json/removeattachment.action",n.search);var l=g.removalConfirmationTitle();var m=g.removalConfirmationBody({filename:e(n)});h(k,l,m)}});