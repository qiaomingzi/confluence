AJS.toInit(function(c){if(!Confluence.Templates.Labels){return}var b=null;var d=function(){c("#"+b.id).find(".label-list").removeClass("editable");b.hide();return false};var a=function(){b=AJS.ConfluenceDialog({width:600,height:250,id:"edit-labels-dialog",onCancel:d});b.addHeader(AJS.I18n.getText("labels.name"));b.addPanel("Label Editor",Confluence.Templates.Labels.dialog());b.addCancel(AJS.I18n.getText("close.name"),d);b.addHelpText(AJS.I18n.getText("labels.dialog.shortcut.tip"),{shortcut:"l"});b.popup.element.find(".dialog-title").prepend(Confluence.Templates.Labels.helpLink());c("#add-labels-form").submit(function(h){var f=c("#labels-string");h.preventDefault();var g=c("#dialog-label-list");AJS.Labels.addLabel(f.val(),g.attr("entityid"),g.attr("entitytype"));f.focus();setTimeout(function(){c("#labels-autocomplete-list").find(".aui-dropdown").addClass("hidden")})});AJS.Labels.bindAutocomplete()};c("#rte-button-labels").live("click",function(f){AJS.Labels.openDialog()});c(".show-labels-editor").click(function(g){g.preventDefault();var f=c(g.target).closest(".labels-section-content");AJS.Labels.openDialog(f)});AJS.Labels.bindOpenDialog=function(e){e.click(function(g){g.preventDefault();var f=c(g.target).closest(".labels-section-content");if(f.length){AJS.Labels.openDialog(f)}else{AJS.Labels.openDialog()}})};AJS.Labels.openDialog=function(g){var h,i,l,k;if(!b){a()}if(g){i=g.attr("entityid");h=g.attr("entitytype")}else{h=AJS.Meta.get("content-type");i=AJS.Meta.get("page-id")}l=AJS.Labels.routes.list(h,i);k=c("#dialog-label-list");k.attr("entityid",i);k.attr("entitytype",h);var f=function(){b.show();c("#labels-string").val("").focus();AJS.trigger("labels.dialog.open")};var j=function(n){k.html(Confluence.Templates.Labels.dialogLabelList({labels:n.labels,spaceKey:AJS.Meta.get("space-key"),editable:true}));f()};if(AJS.Labels.isNewPage()){if(!k.find("ul").children().size()){var e=c("#createPageLabelsString").val()||"";var m=AJS.Labels.parseLabelStringToArray(e);j({labels:m})}else{f()}}else{AJS.$.ajax({url:l,cache:false,success:j,error:function(n,o){AJS.Labels.setLabelError("Unable to fetch current labels from the server.");f()}})}c("#dialog-label-list").attr("data-ready","true")}});