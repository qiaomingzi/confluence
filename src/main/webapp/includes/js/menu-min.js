AJS.menuShowCount=0;(function(){var f=jQuery;var h=null;var g=function(i){if(typeof AJS.dropDownTimer!="undefined"&&AJS.dropDownHider){clearTimeout(AJS.dropDownTimer);delete AJS.dropDownTimer;AJS.dropDownHider();AJS.dropDownHider=null}};var e=function(){return f(".ajs-menu-bar.menu-bar-open").length>0};var a=function(i){f(i).closest(".ajs-menu-bar").find(".ajs-drop-down").each(function(j){this.hide()})};var d=function(i){return f(i).closest(".ajs-menu-bar").hasClass("menu-bar-open")};var b=function(i){f(i).closest(".ajs-menu-bar").addClass("menu-bar-open")};var c=function(i){f(i).closest(".ajs-menu-bar").removeClass("menu-bar-open")};f.fn.ajsMenu=function(i){i=i||{};f(".ajs-button",this).each(function(){f(this).mouseover(function(){var k=this;var m=d(k);a(k);if(m){var l=f(document);var j=function(){c(k);return false};l.unbind("click.menu");setTimeout(function(){l.one("click.menu",j)},1);b(k)}})});f(".ajs-menu-item",this).each(function(){f(this).ajsMenuItem(i)})};f.fn.ajsMenuItem=function(r){r=r||{};var k=this,i=f(this),o=f(".ajs-drop-down",k);if(!o.length){return}o=o[0];o.hidden=true;o.focused=-1;o.hide=function(){if(!this.hidden){i.toggleClass("opened");var t=f(k.parentNode);if(t.find(".opened").length==0){c(k)}var s=f("a",this);f(this).toggleClass("assistive");this.hidden=true;f(document).unbind("click",this.fhide).unbind("keydown",this.fmovefocus).unbind("keypress",this.blocker);if(this.focused+1){f(s[this.focused]).removeClass("active")}this.focused=-1}};o.show=function(){if(typeof this.hidden=="undefined"||this.hidden){var s=this,w=f(this);w.toggleClass("assistive");i.toggleClass("opened");b(k);this.hidden=false;this.timer=setTimeout(function(){f(document).click(s.fhide)},1);f(document).keydown(s.fmovefocus).keypress(s.blocker);var t=f("a",s);t.each(function(y){var x=this.parentNode.parentNode;f(this).hover(function(z){if(x.focused+1){f(t[x.focused].parentNode).removeClass("active")}f(this.parentNode).addClass("active");x.focused=y},function(z){if(x.focused+1){f(t[x.focused].parentNode).removeClass("active")}x.focused=-1})});var v=(window.pageYOffset||document.documentElement.scrollTop);var u=v+f(window).height();w.removeClass("above");if(!r.isFixedPosition){if(w.offset().top+w.height()>u){w.addClass("above");if(w.offset().top<v){w.removeClass("above")}}}}};o.isMenuBarOpened=function(){return d(o)};o.closeOthers=function(){a(o)};o.fmovefocus=function(s){o.movefocus(s)};o.fhide=function(s){o.hide(s);return AJS.$(s.target).closest(".ajs-drop-down").length>0};o.blocker=function(s){var t=s.which;if(t==40||t==38){return false}};o.movefocus=function(u){var x=u.which,t=this.getElementsByTagName("a"),w=this.focused,s=(x==9),v;do{switch(x){case 40:case 9:if(u.shiftKey){this.focused--}else{this.focused++}break;case 38:this.focused--;break;case 27:this.hide();return false;default:return true}v=(this.focused<0||this.focused>t.length-1)}while(!v&&f(t[this.focused].parentNode).hasClass("assistive"));if(s&&v){if(w!=-1){f(t[w].parentNode).removeClass("active")}this.focused=-1;this.hide();return false}else{if(!s){if(this.focused<0){this.focused=t.length-1}else{if(this.focused>t.length-1){this.focused=0}}}}if(w>=0){f(t[w].parentNode).removeClass("active")}t[this.focused].focus();f(t[this.focused].parentNode).addClass("active");u.stopPropagation();u.preventDefault();return false};o.show();clearTimeout(o.timer);var l=f(o),j=l.offset();o.hide();var n=f(".trigger",k);if(n.length){var q=function(){clearTimeout(AJS.dropDownTimer);delete AJS.dropDownTimer;AJS.dropDownHider();AJS.dropDownHider=null;o.show()};var p=function(t){var s=typeof AJS.dropDownTimer!="undefined";h=o;if(s){q()}else{AJS.dropDownShower=function(){o.show();delete AJS.dropDownShowerTimer};AJS.dropDownShowerTimer=setTimeout(AJS.dropDownShower,t)}};var m=function(s){var t=typeof AJS.dropDownShowerTimer!="undefined";if(t){clearTimeout(AJS.dropDownShowerTimer);delete AJS.dropDownShowerTimer}if(typeof AJS.dropDownTimer!="undefined"){clearTimeout(AJS.dropDownTimer);delete AJS.dropDownHider}AJS.dropDownHider=function(){o.hide();delete AJS.dropDownTimer};AJS.dropDownTimer=setTimeout(AJS.dropDownHider,s)};i.mouseover(function(){if(o.isMenuBarOpened()){if(o.hidden){a(o);o.show()}}else{i.addClass("hover")}});i.mouseout(function(){if(!o.isMenuBarOpened()){i.removeClass("hover")}});n.click(function(){if(o.hidden){n.parent("li").removeClass("hover");var s=e();o.show();return s}else{o.hide();n.parent("li").addClass("hover");return false}})}}})();AJS.toInit(function(e){e("#view-user-history-link").click(function(g){window.open(this.href,(this.id+"-popupwindow").replace(/-/g,"_"),"width=600, height=400, scrollbars, resizable");g.preventDefault();return false});var c=function(g){if(e("#action-messages").html().indexOf(g)===-1){AJS.messages.error("#action-messages",{body:g})}};var d=function(j,h,k){if(j.actionErrors){for(var g=0;g<j.actionErrors.length;g++){c(j.actionErrors)}}else{if(j.errorMessage){c(j.errorMessage)}else{k()}}h.removeClass("waiting")};var f=function(h,g){try{return AJS.$.parseJSON(h.responseText)}catch(i){console.error('Error while parsing "'+h.responseText+'": '+i);return g}};e("#page-favourite").click(function(j){var h=e(this),i=h.find("span");if(h.hasClass("waiting")){return AJS.stopEvent(j)}h.addClass("waiting");var g=Confluence.getContextPath()+"/json/addfavourite.action";if(h.hasClass("selected")){g=Confluence.getContextPath()+"/json/removefavourite.action"}AJS.safe.ajax({url:g,type:"POST",dataType:"json",data:{entityId:AJS.params.pageId},success:function(k){d(k,h,function(){h.toggleClass("selected");h.toggleClass("ie-page-favourite-selected");if(h.hasClass("selected")){i.text(AJS.I18n.getText("pagemenu.unfavourite"))}else{i.text(AJS.I18n.getText("pagemenu.favourite"))}})},error:function(k){d(f(k,{}),h,function(){c("Server error while updating favourite")})}});return AJS.stopEvent(j)});var b=e("#action-menu-link"),a=e("#add-menu-link");if(b.length){b.next().addClass("most-right-menu-item")}else{if(a.length){a.next().addClass("most-right-menu-item")}}e("#action-menu").on({"aui-dropdown2-show":function(){e(this).css({right:function(){return e(window).width()-b.offset().left-b.outerWidth(true)-1},left:"auto"})}});e(".ajs-menu-bar").ajsMenu({isFixedPosition:true})});AJS.$(function(a){a("#header-menu-bar .ajs-menu-item").each(function(){var c=a(this),d=a(".ajs-drop-down",this),b=c.width();if(b>d.width()){d.width(b.valueOf()+50);AJS.log("Dropdown width override occurred")}})});