AJS.toInit(function(e){var l=null,q,d,o,r,n,j=false,p,c=100;var i={key:function(){var t=e.Deferred();var u=e.trim(q.val());if(!u){t.reject(AJS.I18n.getText("space.key.empty"));return t}if(p){AJS.log("Aborting previous space key validation request.");p.abort()}p=e.getJSON(AJS.Confluence.getContextPath()+"/ajax/spaceavailable.action",{key:u}).done(function(v){if(!v.available&&v.message){t.reject(v.message)}else{t.resolve()}p=false});return t.promise()},name:function(){var t=e.Deferred();if(!e.trim(d.val())){t.reject(AJS.I18n.getText("space.name.empty"))}else{t.resolve()}return t.promise()}};function m(w){var v=w[0];if(v.setSelectionRange){var u=w.val().length;v.setSelectionRange(0,u)}else{if(v.createTextRange){var t=v.createTextRange();t.execCommand("SelectAll");t.select()}}}function h(t){if(t){o.removeAttr("disabled")}else{o.attr("disabled","disabled")}j=t}var s={};function b(v){h(false);var t=v.attr("name");var u=v.siblings(".error");s[t]=true;var w=i[t]();w.done(function(){delete s[t];u.text("").addClass("hidden")});w.fail(function(x){u.text(x).removeClass("hidden")});w.always(function(){h(e.isEmptyObject(s));v.attr("data-validated-value",v.val())});return w}function a(t){var x=t.find("#space-url-example"),u=AJS.Meta.get("base-url")+"/display/",v="<"+AJS.I18n.getText("space.create.form.key.placeholder")+">",z=function(B){B=B||v;var A=u+B;x.text(A)},w=false;h(false);z();q=t.find("input[name='key']").first();d=t.find("input[name='name']").first();r=q.parent().find(".error");n=d.parent().find(".error");q.generateFrom(d,{uppercase:false,maxNameLength:255,maxKeyLength:255,timeoutMS:c,validationCallback:function(){q.keyup()}});function y(){var B=e(this);var A=B.val();if(typeof B.data("originalVal")==="undefined"){B.data("originalVal","")}if(B.data("originalVal")===A){return}B.data("originalVal",A);b(B)}q.keyup(e.debounce(y,500));d.keyup(y);q.keyup(function(){z(q.val())});q.focus(function(){m(q)});t.find("#permission-private").change(function(){e("#permissions-group").toggleClass("locked")});t.submit(function(A){if(!w){A.preventDefault()}else{return}setTimeout(function(){var C=b(q);var B=b(d);e.when({},C,B).then(function(){if(j){w=true;t.submit()}})},c+1)})}function f(){var u=e(Confluence.Templates.CreateSpace.createSpaceForm({atlToken:e("#atlassian-token").prop("content")})),t=function(){u.submit()},v=function(){w.hide();d.val("");q.val("");r.text("").addClass("hidden");n.text("").addClass("hidden");h(false)},w=new AJS.ConfluenceDialog({width:600,height:400,id:"create-space-dialog",closeOnOutsideClick:true,onCancel:v,onSubmit:t});w.addHeader(AJS.I18n.getText("space.create.form.title"));w.addPanel("Panel 1",u);w.addSubmit(AJS.I18n.getText("space.create.form.submit.button"),t);w.addCancel(AJS.I18n.getText("cancel.name"),v);w.popup.element.find(".dialog-title").prepend(Confluence.Templates.CreateSpace.helpLink());o=w.popup.element.find(".button-panel-submit-button");a(u);w.gotoPage(0);w.gotoPanel(0);return w}function g(t){t&&t.preventDefault();if(!l){l=f()}l.show()}AJS.bind("ready-for-create-space-form-init",function(u,t){o=t.find("input[type=submit]");a(t)});e('a[href="'+AJS.contextPath()+'/spaces/createspace-start.action"]').click(g);var k=e("#create-space-form:not(.noautobind)");if(k.length){AJS.trigger("ready-for-create-space-form-init",[k])}});