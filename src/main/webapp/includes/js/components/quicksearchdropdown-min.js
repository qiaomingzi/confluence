(function(a){a.fn.quicksearch=function(f,i,e){if(i){e.onShow=i}e.makeParams=e.makeParams||function(j){return{query:j}};var c=function(l){var m=l.statusMessage;var k;if(m){k=[[{html:l.statusMessage,className:"error"}]]}else{if(e.makeRestMatrixFromData){var j=e.makeRestMatrixFromData(l);k=AJS.REST.convertFromRest(j);if(e.addDropdownData){k=e.addDropdownData(k)}}else{k=l.contentNameMatches}}return k};var d,h;if(typeof f=="function"){h=f();d=function(k){var j=f();if(j!=h){h=j;k.clearCache()}return j}}else{d=function(){return f}}e.getDataAndRunCallback=e.getDataAndRunCallback||function(n,o){var m=this,k=d(m,n);if(e.includeUrlPrefix==undefined||e.includeUrlPrefix){k=(AJS.Meta.get("context-path")||"")+k}var j=a.data(m,"lastRequest");if(j){j.abort()}var l=a.ajax({type:"GET",dataType:"json",url:k,xhrFields:{withCredentials:true},data:e.makeParams(n),success:function(q,r){a(window).trigger("quicksearch.ajax-success",{url:k,json:q,resultStatus:r});if(document.activeElement!=b[0]){return}var p=c(q);o.call(m,p,n,q.queryTokens)},global:false,timeout:5000,error:function(s,q,r){a(window).trigger("quicksearch.ajax-error",{url:k,xmlHttpRequest:s,resultStatus:q,errorThrown:r});if(document.activeElement!=b[0]){return}if(q=="timeout"){var p=c({statusMessage:"Timeout",query:n});o.call(m,p,null)}},complete:function(){a.removeData(m,"lastRequest")}});a.data(m,"lastRequest",l);b.trigger("quick-search-loading-start");l.always(function(){b.trigger("quick-search-loading-stop")})};var g=AJS.inputDrivenDropdown(e),b=a(this);b.keyup(function(j){if(j.which==13||j.which==9){AJS.debug("quicksearchdropdown: enter or tab keyup");return}!b.hasClass("placeholded")&&g.change(this.value)});b.quickSearchControl=g;b.bind("clearCache.autocomplete",function(){g.clearCache()});b.bind("hide.autocomplete",function(){g.hide()});return b}})(jQuery);