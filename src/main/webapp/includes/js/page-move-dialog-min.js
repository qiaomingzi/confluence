AJS.toInit(function(g){var h=840;var e=590;var f=71;Confluence.MovePageDialog=function(k){var p=AJS.Meta.get("page-title");k=g.extend({spaceKey:AJS.Meta.get("space-key"),spaceName:AJS.Meta.get("space-name"),pageTitle:p,parentPageTitle:AJS.Meta.get("parent-page-title"),title:AJS.I18n.getText("move.page.dialog.title.view",p),buttonName:AJS.I18n.getText("move.name"),openedPanel:AJS.I18n.getText("move.page.dialog.panel.location"),moveHandler:function(I){AJS.log("No move handler defined. Closing dialog.");I.remove()},cancelHandler:function(I){I.remove();return false}},k);var z={spaceKey:k.spaceKey,spaceName:k.spaceName,parentPageTitle:k.parentPageTitle};var j=k.spaceKey;var B=k.spaceName;var F=k.parentPageTitle;var n="";var q="";var o=function(I,J){n=I;q=J};var G=AJS.ConfluenceDialog({width:h,height:e,id:"move-page-dialog"});G.addHeader(k.title);G.addPanel(AJS.I18n.getText("move.page.dialog.panel.location"),AJS.renderTemplate("movePageDialog"),"location-panel","location-panel-id");G.addPanel(AJS.I18n.getText("move.page.dialog.search.title"),AJS.renderTemplate("movePageSearchPanel"),"search-panel","search-panel-id");G.addPanel(AJS.I18n.getText("move.page.dialog.history.title"),Confluence.Templates.MovePage.historyPanel({pageTitle:AJS.Meta.get("page-title")}),"history-panel","history-panel-id");G.addPanel(AJS.I18n.getText("move.page.dialog.browse.title"),Confluence.Templates.MovePage.browsePanel({pageTitle:AJS.Meta.get("page-title")}),"browse-panel","browse-panel-id");G.get('#"'+AJS.I18n.getText("move.page.dialog.panel.location")+'"')[0].onselect=function(){g("#new-space-key").val(j);g("#new-space").val(B);g("#new-parent-page").val(F).select()};G.get('#"'+AJS.I18n.getText("move.page.dialog.search.title")+'"')[0].onselect=function(){g("#move-page-dialog .search-panel .search-results .selected").removeClass("selected");g("#move-page-dialog input.search-query").focus()};G.get('#"'+AJS.I18n.getText("move.page.dialog.history.title")+'"')[0].onselect=function(){g(".history-panel",C).movePageHistory(u)};G.get('#"'+AJS.I18n.getText("move.page.dialog.browse.title")+'"')[0].onselect=function(){AJS.log("browse: "+[j,B,F].join());g(".browse-panel",C).movePageBrowse(u,j,B,F,t,k.pageTitle)};var A=function(J){J.nextPage();var I=g("#move-page-dialog");g(".ordering-panel",I).movePageOrdering(j,F,k.pageTitle,o)};var x=function(J){var L=g("#new-space:visible").val();var K=g("#new-space-key").val();var I=g("#new-parent-page:visible").val();if(L&&(L!=B||K!=j||I!=F)){AJS.MoveDialog.getBreadcrumbs({spaceKey:K,pageTitle:I},function(){Confluence.PageLocation.set({spaceKey:K,spaceName:L,parentPageTitle:I});k.moveHandler(J,K,L,I,n,q,i)},function(M){g("#new-parent-breadcrumbs").html(Confluence.Templates.MovePage.breadcrumbError());if(M.status==404){u.error(AJS.I18n.getText("move.page.dialog.location.not.found"))}})}else{Confluence.PageLocation.set({spaceKey:j,spaceName:B,parentPageTitle:F});k.moveHandler(J,j,B,F,n,q,i)}};var H=function(I){if(g("#reorderCheck")[0].checked){A(I)}else{x(I)}};G.addButton(k.buttonName,H,"move-button");G.addCancel(AJS.I18n.getText("cancel.name"),k.cancelHandler);G.popup.element.find(".dialog-title").prepend(Confluence.Templates.MovePage.helpLink());G.addPage().addHeader(k.title).addPanel(AJS.I18n.getText("move.page.dialog.ordering.title"),Confluence.Templates.MovePage.orderingPagePanel(),"ordering-panel","ordering-panel-id").addLink(AJS.I18n.getText("move.page.dialog.back.button"),function(I){I.prevPage()},"dialog-back-link").addButton(AJS.I18n.getText("move.page.dialog.order.button"),x,"reorder-button").addCancel(AJS.I18n.getText("cancel.name"),k.cancelHandler);var D=G.get("button#"+k.buttonName)[0].item;g("button.move-button").before(Confluence.Templates.MovePage.reorderCheckbox());G.gotoPage(0);var C=g("#move-page-dialog");var y=C.find(".dialog-page-menu");var s=C.find(".dialog-page-body");var m=g(y[0]);var w=g(s[0]);w.height(m.height());w.width("75%");w.find(".dialog-panel-body").height(m.height()-f);var r=g(y[1]);var E=g(s[1]);r.width("0");E.width("100%");G.show();g(".location-panel .location-info",C).appendTo(g(".dialog-page-body:first",C));var l=new AJS.MoveDialog.Breadcrumbs(g("#new-parent-breadcrumbs"));function i(M){var L=g("#move-errors");if(L.length>0){L.remove()}L=g(Confluence.Templates.MovePage.errorMessage());var J=C.find(".browse-controls:visible");if(!J.length){J=C.find(".dialog-panel-body:visible")}J.append(L);if(!M||M.length==0){g(D).prop("disabled",false);return}var I=AJS.I18n.getText("errors.occurred");I+="<ul>\n<li>";if(g.isArray(M)){I+=M.join("</li>\n<li>")}else{I+=M}I+="</li>\n</ul>";var K=aui.message.warning({content:I});L.html(K);L.removeClass("hidden");G.gotoPage(0)}var u={moveButton:D,clearErrors:function(){i([])},error:i,select:function(K,J,I){AJS.log("select: "+[K,J,I].join());j=K;B=J;F=I||"";g(D).prop("disabled",true);l.update({spaceKey:j,title:F},u)}};G.overrideLastTab();G.get('#"'+k.openedPanel+'"').select();var t=AJS.Meta.get("parent-page-title")||AJS.Meta.get("from-page-title");var v=new AJS.MoveDialog.Breadcrumbs(g("#current-parent-breadcrumbs"));v.update({spaceKey:AJS.Meta.get("space-key"),title:t},u);g(".location-panel",C).movePageLocation(u);g(".search-panel",C).movePageSearch(u);g(".history-panel",C).movePageHistory(u);g("#new-parent-page").select();if(k.hint){G.addHelpText(k.hint.template||k.hint.text,k.hint.arguments)}return C};var d=function(k,j,l,i){var m={pageId:AJS.params.pageId,spaceKey:k};if(l){m.position=i;m.targetId=l}else{if(j!=""){m.targetTitle=j;m.position="append"}else{m.position="topLevel"}}return m};function a(m,o,i,p,r,j,l){m=m.popup.element;m.addClass("waiting");g("button",m).prop("disabled",true);var k=g("<div class='throbber'></div>");m.append(k);var q=Raphael.spinner(k[0],100,"#666");function n(s){l(s);m.removeClass("waiting");q();g("button",m).prop("disabled",false)}g.ajax({url:contextPath+"/pages/movepage.action",type:"GET",dataType:"json",data:new d(o,p,r,j),error:function(){n(AJS.I18n.getText("move.page.dialog.move.failed"))},success:function(s){var t=[].concat(s.validationErrors||[]).concat(s.actionErrors||[]).concat(s.errorMessage||[]);if(t.length>0){n(t);return}window.location.href=contextPath+s.page.url+(s.page.url.indexOf("?")>=0?"&":"?")+"moved=true"}})}g("#action-move-page-dialog-link").click(function(i){i.preventDefault();if(g("#move-page-dialog").length>0){g("#move-page-dialog, body > .shadow, body > .aui-blanket").remove()}new Confluence.MovePageDialog({moveHandler:a});return false});var c;g("#rte-button-location").click(function(i){i.preventDefault();if(g("#move-page-dialog").length>0){g("#move-page-dialog, body > .shadow, body > .aui-blanket").remove()}new Confluence.MovePageDialog({spaceName:c,spaceKey:g("#newSpaceKey").val(),pageTitle:g("#content-title").val(),parentPageTitle:g("#parentPageString").val(),buttonName:AJS.I18n.getText("move.name"),title:AJS.I18n.getText("move.page.dialog.title.edit"),moveHandler:function(n,k,o,p,m,l,j){c=o;g("#newSpaceKey").val(k);g("#parentPageString").val(p);if(p!=""){g("#position").val("append")}else{g("#position").val("topLevel")}if(m){g("#targetId").val(m);g("#position").val(l)}n.remove()}});return false});var b=null;Confluence.PageLocation={get:function(){if(b){return b}return{spaceName:AJS.Meta.get("space-name"),spaceKey:AJS.Meta.get("space-key"),parentPageTitle:AJS.Meta.get("parent-page-title")}},set:function(i){b=i}}});